<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>Class: UploadProgress::Progress</title>
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
  <meta http-equiv="Content-Script-Type" content="text/javascript" />
  <link rel="stylesheet" href="../.././rdoc-style.css" type="text/css" media="screen" />
  <script type="text/javascript">
  // <![CDATA[

  function popupCode( url ) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }

  function toggleCode( id ) {
    if ( document.getElementById )
      elem = document.getElementById( id );
    else if ( document.all )
      elem = eval( "document.all." + id );
    else
      return false;

    elemStyle = elem.style;
    
    if ( elemStyle.display != "block" ) {
      elemStyle.display = "block"
    } else {
      elemStyle.display = "none"
    }

    return true;
  }
  
  // Make codeblocks hidden by default
  document.writeln( "<style type=\"text/css\">div.method-source-code { display: none }</style>" )
  
  // ]]>
  </script>

</head>
<body>



    <div id="classHeader">
        <table class="header-table">
        <tr class="top-aligned-row">
          <td><strong>Class</strong></td>
          <td class="class-name-in-header">UploadProgress::Progress</td>
        </tr>
        <tr class="top-aligned-row">
            <td><strong>In:</strong></td>
            <td>
                <a href="../../files/vendor/plugins/upload_progress/lib/progress_rb.html">
                vendor/plugins/upload_progress/lib/progress.rb
                </a>
        <br />
            </td>
        </tr>

        <tr class="top-aligned-row">
            <td><strong>Parent:</strong></td>
            <td>
                Object
            </td>
        </tr>
        </table>
    </div>
  <!-- banner header -->

  <div id="bodyContent">



  <div id="contextContent">

    <div id="description">
      <p>
Upload <a href="Progress.html">Progress</a> abstracts the progress of an
upload. It&#8216;s used by the multipart progress IO that keeps track of
the upload progress and creating the application depends on. It contians
methods to update the progress during an upload and read the statistics
such as <tt>received_bytes</tt>, <tt>total_bytes</tt>, <tt><a
href="Progress.html#M000017">completed_percent</a></tt>, <tt><a
href="Progress.html#M000018">bitrate</a></tt>, and <tt><a
href="Progress.html#M000020">remaining_seconds</a></tt>
</p>
<p>
You can get the current <tt><a href="Progress.html">Progress</a></tt>
object by calling <tt>upload_progress</tt> instance method in your
controller or view.
</p>

    </div>


   </div>

    <div id="method-list">
      <h3 class="section-bar">Methods</h3>

      <div class="name-list">
      <a href="#M000018">bitrate</a>&nbsp;&nbsp;
      <a href="#M000017">completed_percent</a>&nbsp;&nbsp;
      <a href="#M000019">elapsed_seconds</a>&nbsp;&nbsp;
      <a href="#M000021">finished?</a>&nbsp;&nbsp;
      <a href="#M000014">new</a>&nbsp;&nbsp;
      <a href="#M000016">remaining_bytes</a>&nbsp;&nbsp;
      <a href="#M000020">remaining_seconds</a>&nbsp;&nbsp;
      <a href="#M000015">reset!</a>&nbsp;&nbsp;
      <a href="#M000023">stalled?</a>&nbsp;&nbsp;
      <a href="#M000022">started?</a>&nbsp;&nbsp;
      </div>
    </div>

  </div>


    <!-- if includes -->

    <div id="section">


    <div id="constants-list">
      <h3 class="section-bar">Constants</h3>

      <div class="name-list">
        <table summary="Constants">
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">MIN_SAMPLE_TIME</td>
          <td>=</td>
          <td class="context-item-value">0.150</td>
          <td width="3em">&nbsp;</td>
          <td class="context-item-desc">
Number of seconds between <a href="Progress.html#M000018">bitrate</a>
samples. Updates that occur more frequently than <tt>MIN_SAMPLE_TIME</tt>
will not be queued until this time passes. This behavior gives a good
balance of accuracy and load for both fast and slow transfers.

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">MIN_STALL_TIME</td>
          <td>=</td>
          <td class="context-item-value">10.0</td>
          <td width="3em">&nbsp;</td>
          <td class="context-item-desc">
Number of seconds between updates before giving up to try and calculate <a
href="Progress.html#M000018">bitrate</a> anymore

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">MAX_SAMPLES</td>
          <td>=</td>
          <td class="context-item-value">20</td>
          <td width="3em">&nbsp;</td>
          <td class="context-item-desc">
Number of samples used to calculate <a
href="Progress.html#M000018">bitrate</a>

</td>
        </tr>
        </table>
      </div>
    </div>



    <div id="attribute-list">
      <h3 class="section-bar">Attributes</h3>

      <div class="name-list">
        <table>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">last_update_time</td>
          <td class="context-item-value">&nbsp;[R]&nbsp;</td>
          <td class="context-item-desc">
The last time the upload history was updated

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">message</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc">
A message you can set from your controller or view to be rendered in the
<tt>upload_status_text</tt> helper method. If you set a messagein a
controller then call <tt>session.update</tt> to make that message available
to your <tt>upload_status</tt> action.

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">received_bytes</td>
          <td class="context-item-value">&nbsp;[R]&nbsp;</td>
          <td class="context-item-desc">
Number bytes received from the multipart post

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">total_bytes</td>
          <td class="context-item-value">&nbsp;[R]&nbsp;</td>
          <td class="context-item-desc">
Total number of bytes expected from the mutlipart post

</td>
        </tr>
        </table>
      </div>
    </div>
      


    <!-- if method_list -->
    <div id="methods">
      <h3 class="section-bar">Public Class methods</h3>

      <div id="method-M000014" class="method-detail">
        <a name="M000014"></a>

        <div class="method-heading">
          <a href="#M000014" class="method-signature">
          <span class="method-name">new</span><span class="method-args">(total)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Create a <a href="Progress.html#M000014">new</a> <a
href="Progress.html">Progress</a> object passing the expected number of
bytes to receive
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000014-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000014-source">
<pre>
    <span class="ruby-comment cmt"># File vendor/plugins/upload_progress/lib/progress.rb, line 44</span>
44:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">initialize</span>(<span class="ruby-identifier">total</span>)
45:       <span class="ruby-ivar">@total_bytes</span> = <span class="ruby-identifier">total</span>
46:       <span class="ruby-identifier">reset!</span>
47:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <h3 class="section-bar">Public Instance methods</h3>

      <div id="method-M000018" class="method-detail">
        <a name="M000018"></a>

        <div class="method-heading">
          <a href="#M000018" class="method-signature">
          <span class="method-name">bitrate</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Calculates the <a href="Progress.html#M000018">bitrate</a> in bytes/second.
If the transfer is stalled or just started, the <a
href="Progress.html#M000018">bitrate</a> will be 0
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000018-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000018-source">
<pre>
     <span class="ruby-comment cmt"># File vendor/plugins/upload_progress/lib/progress.rb, line 108</span>
108:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">bitrate</span>
109:       <span class="ruby-identifier">history_bytes</span>, <span class="ruby-identifier">history_time</span> = <span class="ruby-ivar">@history</span>.<span class="ruby-identifier">transpose</span>.<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">vals</span><span class="ruby-operator">|</span> <span class="ruby-identifier">vals</span>.<span class="ruby-identifier">inject</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">sum</span>, <span class="ruby-identifier">v</span><span class="ruby-operator">|</span> <span class="ruby-identifier">sum</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">v</span> } } 
110:       <span class="ruby-identifier">history_bytes</span> <span class="ruby-operator">/</span> <span class="ruby-identifier">history_time</span> <span class="ruby-keyword kw">rescue</span> <span class="ruby-value">0</span>
111:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000017" class="method-detail">
        <a name="M000017"></a>

        <div class="method-heading">
          <a href="#M000017" class="method-signature">
          <span class="method-name">completed_percent</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Completed percent in integer form from 0..100
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000017-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000017-source">
<pre>
    <span class="ruby-comment cmt"># File vendor/plugins/upload_progress/lib/progress.rb, line 62</span>
62:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">completed_percent</span>
63:       (<span class="ruby-ivar">@received_bytes</span> <span class="ruby-operator">*</span> <span class="ruby-value">100</span> <span class="ruby-operator">/</span> <span class="ruby-ivar">@total_bytes</span>).<span class="ruby-identifier">to_i</span> <span class="ruby-keyword kw">rescue</span> <span class="ruby-value">0</span>
64:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000019" class="method-detail">
        <a name="M000019"></a>

        <div class="method-heading">
          <a href="#M000019" class="method-signature">
          <span class="method-name">elapsed_seconds</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Number of seconds elapsed since the start of the upload
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000019-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000019-source">
<pre>
     <span class="ruby-comment cmt"># File vendor/plugins/upload_progress/lib/progress.rb, line 114</span>
114:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">elapsed_seconds</span>
115:       <span class="ruby-ivar">@last_update_time</span>
116:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000021" class="method-detail">
        <a name="M000021"></a>

        <div class="method-heading">
          <a href="#M000021" class="method-signature">
          <span class="method-name">finished?</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns true if there are bytes pending otherwise returns false
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000021-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000021-source">
<pre>
     <span class="ruby-comment cmt"># File vendor/plugins/upload_progress/lib/progress.rb, line 125</span>
125:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">finished?</span>
126:       <span class="ruby-identifier">remaining_bytes</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-value">0</span>
127:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000016" class="method-detail">
        <a name="M000016"></a>

        <div class="method-heading">
          <a href="#M000016" class="method-signature">
          <span class="method-name">remaining_bytes</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Number of bytes left for this upload
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000016-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000016-source">
<pre>
    <span class="ruby-comment cmt"># File vendor/plugins/upload_progress/lib/progress.rb, line 57</span>
57:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">remaining_bytes</span>
58:       <span class="ruby-ivar">@total_bytes</span> <span class="ruby-operator">-</span> <span class="ruby-ivar">@received_bytes</span>
59:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000020" class="method-detail">
        <a name="M000020"></a>

        <div class="method-heading">
          <a href="#M000020" class="method-signature">
          <span class="method-name">remaining_seconds</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Calculate the seconds remaining based on the current <a
href="Progress.html#M000018">bitrate</a>. Returns O seconds if stalled or
if no bytes have been received
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000020-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000020-source">
<pre>
     <span class="ruby-comment cmt"># File vendor/plugins/upload_progress/lib/progress.rb, line 120</span>
120:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">remaining_seconds</span>
121:       <span class="ruby-identifier">remaining_bytes</span> <span class="ruby-operator">/</span> <span class="ruby-identifier">bitrate</span> <span class="ruby-keyword kw">rescue</span> <span class="ruby-value">0</span>
122:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000015" class="method-detail">
        <a name="M000015"></a>

        <div class="method-heading">
          <a href="#M000015" class="method-signature">
          <span class="method-name">reset!</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Resets the received_bytes, last_update_time, message and <a
href="Progress.html#M000018">bitrate</a>, but but maintains the total
expected bytes
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000015-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000015-source">
<pre>
    <span class="ruby-comment cmt"># File vendor/plugins/upload_progress/lib/progress.rb, line 51</span>
51:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">reset!</span>
52:       <span class="ruby-ivar">@received_bytes</span>, <span class="ruby-ivar">@last_update_time</span>, <span class="ruby-ivar">@stalled</span>, <span class="ruby-ivar">@message</span> = <span class="ruby-value">0</span>, <span class="ruby-value">0</span>, <span class="ruby-keyword kw">false</span>, <span class="ruby-value str">''</span>
53:       <span class="ruby-identifier">reset_history</span>
54:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000023" class="method-detail">
        <a name="M000023"></a>

        <div class="method-heading">
          <a href="#M000023" class="method-signature">
          <span class="method-name">stalled?</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns true if there has been a delay in receiving bytes. The delay is set
by the constant MIN_STALL_TIME
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000023-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000023-source">
<pre>
     <span class="ruby-comment cmt"># File vendor/plugins/upload_progress/lib/progress.rb, line 136</span>
136:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">stalled?</span>
137:       <span class="ruby-ivar">@stalled</span>
138:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000022" class="method-detail">
        <a name="M000022"></a>

        <div class="method-heading">
          <a href="#M000022" class="method-signature">
          <span class="method-name">started?</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns true if some bytes have been received
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000022-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000022-source">
<pre>
     <span class="ruby-comment cmt"># File vendor/plugins/upload_progress/lib/progress.rb, line 130</span>
130:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">started?</span>
131:       <span class="ruby-ivar">@received_bytes</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
132:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>


    </div>


  </div>


<div id="validator-badges">
  <p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
</div>

</body>
</html>